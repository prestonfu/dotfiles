%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% prestonfu.sty - Copyright Preston Fu 2020                          %
% Thanks to Evan Chen and Eric Shen                                  %
% https://github.com/prestonfu/dotfiles/blob/master/prestonfu.sty    %
% raw.githubusercontent.com/prestonfu/dotfiles/master/prestonfu.sty  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{prestonfu}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          OPTIONS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newif\ifprestonmdthm\prestonmdthmfalse
\newif\ifprestoncolor\prestoncolortrue
\newif\ifprestonmonochrome\prestonmonochromefalse
\newif\ifprestonchthm\prestonchthmfalse
\newif\ifprestonbook\prestonbookfalse
\newif\ifprestonsecthm\prestonsecthmtrue
\newif\ifprestonfancysec\prestonfancysectrue
\newif\ifprestonfancy\prestonfancytrue
\newif\ifprestonqednow\prestonqednowfalse
\newif\ifprestonfancyhint\prestonfancyhintfalse
\newif\ifprestonams\prestonamsfalse
\newif\ifprestonpazo\prestonpazofalse
\newif\ifprestonroboto\prestonrobotofalse
\newif\ifprestonsetlinespacing\prestonsetlinespacingtrue
\newif\ifprestonnoindent\prestonnoindentfalse
\newif\ifprestonmarginset\prestonmarginsettrue
\newif\ifprestonindex\prestonindexfalse

\DeclareOption{mdthm}{\prestonmdthmtrue}
\DeclareOption{nomdthm}{\prestonmdthmfalse}
\DeclareOption{color}{\prestoncolortrue}
\DeclareOption{nocolor}{\prestoncolorfalse}
\DeclareOption{monochrome}{\prestoncolorfalse\prestonmonochrometrue}
\DeclareOption{secthm}{\prestonsecthmtrue}
\DeclareOption{nosecthm}{\prestonsecthmfalse}
\DeclareOption{chthm}{\prestonchthmtrue}
\DeclareOption{fancysec}{\prestonfancysectrue}
\DeclareOption{nofancysec}{\prestonfancysecfalse}
\DeclareOption{fancy}{\prestonfancytrue}
\DeclareOption{nofancy}{\prestonfancyfalse}
\DeclareOption{qednow}{\prestonqednowtrue}
\DeclareOption{fancyhint}{\prestonfancyhinttrue}
\DeclareOption{pazo}{\prestonpazotrue}
\DeclareOption{roboto}{\prestonrobototrue}
\DeclareOption{nolinespaceset}{\prestonnoindenttrue}
\DeclareOption{noindent}{\prestonnoindenttrue}
\DeclareOption{nomarginset}{\prestonmarginsetfalse}
\DeclareOption{index}{\prestonindextrue}

\@ifundefined{KOMAClassName}{
    \newcommand{\headingfont}{\bfseries}
    \newcommand{\sansfont}{\normalfont}
    \prestoncolorfalse
    \prestonfancytrue
}{
    \newcommand{\headingfont}{\sffamily\bfseries}
    \newcommand{\sansfont}{\sffamily}
    \prestonmdthmtrue
}

\DeclareOption{ams}{
    \prestoncolorfalse
    \prestonfancyfalse
    \prestonamstrue
}

\DeclareOption{book}{
    \prestonbooktrue
    \prestonfancyhinttrue
}

\ProcessOptions\relax

\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{amsthm}
\usepackage{thmtools}
\PassOptionsToPackage{usenames,svgnames,dvipsnames}{xcolor}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[english]{babel}
\usepackage{mathdots}
\usepackage[final]{pdfpages}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{epigraph}
\usepackage{hyperref}
\usepackage{mathrsfs}
\usepackage{textcomp}
\usepackage{emptypage}
\usepackage{appendix}
\usepackage{imakeidx}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%      USEFUL COMMANDS      %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\dotp}{\boldsymbol{\cdot}}
\newcommand{\x}{\times}
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\braces}[1]{\left \{ #1 \right \}}
\newcommand{\set}[1]{\left \{ #1 \right \}}
\newcommand{\parens}[1]{\left( #1 \right)}
\newcommand{\brackets}[1]{\left[ #1 \right]}
\newcommand{\angleb}[1]{\left\langle #1 \right\rangle}
\newcommand{\pfrac}[2]{\parens{\frac{#1}{#2}}}
\newcommand{\mailto}[1]{\href{mailto:#1}{\texttt{#1}}}
\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\eps}{\varepsilon}
\renewcommand{\deg}{^\circ}
\renewcommand{\bold}[1]{{\boldmath\bfseries #1}}
\ifprestoncolor
    \newcommand{\vocab}[1]{\bold{\color{NavyBlue} #1}}
\else
    \newcommand{\vocab}[1]{\bold{#1}}
\fi
\newcommand{\hrulebar}{\begin{center}\nointerlineskip\vspace{5pt}\rule{\textwidth}{.7pt}\hspace{\fill}\end{center}}
\newcommand{\ans}[5]{\textbf{(A) }#1\qquad\textbf{(B) }#2\qquad\textbf{(C) }#3\qquad\textbf{(D) }#4\qquad\textbf{(E) }#5}
\newcommand{\id}{\mathrm{id}}
\newcommand{\inv}{^{-1}}

% Functions
\DeclareMathOperator*{\lcm}{lcm} % least common multiple
\DeclareMathOperator*{\re}{Re} % real part
\DeclareMathOperator*{\im}{Im} % imaginary part
\DeclareMathOperator*{\Pow}{Pow} % power
\DeclareMathOperator*{\diam}{diam} % diameter
\DeclareMathOperator*{\mesh}{mesh} % mesh
\DeclareMathOperator*{\ord}{ord} % order
\DeclareMathOperator*{\adj}{adj} % adjugate
\DeclareMathOperator*{\cur}{curl} % curl
\DeclareMathOperator*{\die}{div} % divergence
\DeclareMathOperator*{\cis}{cis} % cis
\DeclareMathOperator*{\rank}{rank} % rank
\DeclareMathOperator*{\Spec}{Spec} % spectrum
\DeclareMathOperator*{\Tr}{Tr} % trace
\DeclareMathOperator*{\Dom}{Dom} % domain
\DeclareMathOperator*{\Rng}{Rng} % range
\DeclareMathOperator*{\Aut}{Aut} % automorphism
\DeclareMathOperator*{\Inn}{Inn} % inner automorphism
\DeclareMathOperator*{\image}{im} % image
\DeclareMathOperator*{\Gal}{Gal} % Galois Group

% Sums and Products
\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

% Letters
\newcommand{\BB}{\mathbb B}
\newcommand{\CC}{\mathbb C}
\newcommand{\DD}{\mathbb D}
\newcommand{\EE}{\mathbb E}
\newcommand{\FF}{\mathbb F}
\newcommand{\GG}{\mathbb G}
\newcommand{\HH}{\mathbb H}
\newcommand{\II}{\mathbb I}
\newcommand{\JJ}{\mathbb J}
\newcommand{\KK}{\mathbb K}
\newcommand{\LL}{\mathbb L}
\newcommand{\MM}{\mathbb M}
\newcommand{\NN}{\mathbb N}
\newcommand{\OO}{\mathbb O}
\newcommand{\PP}{\mathbb P}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\TT}{\mathbb T}
\newcommand{\UU}{\mathbb U}
\newcommand{\VV}{\mathbb V}
\newcommand{\WW}{\mathbb W}
\newcommand{\XX}{\mathbb X}
\newcommand{\YY}{\mathbb Y}
\newcommand{\ZZ}{\mathbb Z}

\newcommand{\ii}{\textbf \i}
\newcommand{\jj}{\textbf \j}
\newcommand{\kk}{\textbf k}
\newcommand{\ihat}{\hat\ii}
\newcommand{\jhat}{\hat\jj}
\newcommand{\khat}{\hat\kk}

\newcommand{\mfA}{\mathfrak A}
\newcommand{\mfB}{\mathfrak B}
\newcommand{\mfC}{\mathfrak C}
\newcommand{\mfD}{\mathfrak D}
\newcommand{\mfE}{\mathfrak E}
\newcommand{\mfF}{\mathfrak F}
\newcommand{\mfG}{\mathfrak G}
\newcommand{\mfH}{\mathfrak H}
\newcommand{\mfI}{\mathfrak I}
\newcommand{\mfJ}{\mathfrak J}
\newcommand{\mfK}{\mathfrak K}
\newcommand{\mfL}{\mathfrak L}
\newcommand{\mfM}{\mathfrak M}
\newcommand{\mfN}{\mathfrak N}
\newcommand{\mfO}{\mathfrak O}
\newcommand{\mfP}{\mathfrak P}
\newcommand{\mfQ}{\mathfrak Q}
\newcommand{\mfR}{\mathfrak R}
\newcommand{\mfS}{\mathfrak S}
\newcommand{\mfT}{\mathfrak T}
\newcommand{\mfU}{\mathfrak U}
\newcommand{\mfV}{\mathfrak V}
\newcommand{\mfW}{\mathfrak W}
\newcommand{\mfX}{\mathfrak X}
\newcommand{\mfY}{\mathfrak Y}
\newcommand{\mfZ}{\mathfrak Z}

\newcommand{\mfa}{\mathfrak a}
\newcommand{\mfb}{\mathfrak b}
\newcommand{\mfc}{\mathfrak c}
\newcommand{\mfd}{\mathfrak d}
\newcommand{\mfe}{\mathfrak e}
\newcommand{\mff}{\mathfrak f}
\newcommand{\mfg}{\mathfrak g}
\newcommand{\mfh}{\mathfrak h}
\newcommand{\mfi}{\mathfrak i}
\newcommand{\mfj}{\mathfrak j}
\newcommand{\mfk}{\mathfrak k}
\newcommand{\mfl}{\mathfrak l}
\newcommand{\mfm}{\mathfrak m}
\newcommand{\mfn}{\mathfrak n}
\newcommand{\mfo}{\mathfrak o}
\newcommand{\mfp}{\mathfrak p}
\newcommand{\mfq}{\mathfrak q}
\newcommand{\mfr}{\mathfrak r}
\newcommand{\mfs}{\mathfrak s}
\newcommand{\mft}{\mathfrak t}
\newcommand{\mfu}{\mathfrak u}
\newcommand{\mfv}{\mathfrak v}
\newcommand{\mfw}{\mathfrak w}
\newcommand{\mfx}{\mathfrak x}
\newcommand{\mfy}{\mathfrak y}
\newcommand{\mfz}{\mathfrak z}

\newcommand{\mcA}{\mathcal A} 
\newcommand{\mcB}{\mathcal B} 
\newcommand{\mcC}{\mathcal C} 
\newcommand{\mcD}{\mathcal D} 
\newcommand{\mcE}{\mathcal E} 
\newcommand{\mcF}{\mathcal F} 
\newcommand{\mcG}{\mathcal G} 
\newcommand{\mcH}{\mathcal H} 
\newcommand{\mcI}{\mathcal I} 
\newcommand{\mcJ}{\mathcal J} 
\newcommand{\mcK}{\mathcal K} 
\newcommand{\mcL}{\mathcal L} 
\newcommand{\mcM}{\mathcal M} 
\newcommand{\mcN}{\mathcal N} 
\newcommand{\mcO}{\mathcal O} 
\newcommand{\mcP}{\mathcal P} 
\newcommand{\mcQ}{\mathcal Q} 
\newcommand{\mcR}{\mathcal R} 
\newcommand{\mcS}{\mathcal S} 
\newcommand{\mcT}{\mathcal T} 
\newcommand{\mcU}{\mathcal U} 
\newcommand{\mcV}{\mathcal V} 
\newcommand{\mcW}{\mathcal W} 
\newcommand{\mcX}{\mathcal X} 
\newcommand{\mcY}{\mathcal Y} 
\newcommand{\mcZ}{\mathcal Z}

\newcommand{\msA}{\mathscr A} 
\newcommand{\msB}{\mathscr B} 
\newcommand{\msC}{\mathscr C} 
\newcommand{\msD}{\mathscr D} 
\newcommand{\msE}{\mathscr E} 
\newcommand{\msF}{\mathscr F} 
\newcommand{\msG}{\mathscr G} 
\newcommand{\msH}{\mathscr H} 
\newcommand{\msI}{\mathscr I} 
\newcommand{\msJ}{\mathscr J} 
\newcommand{\msK}{\mathscr K} 
\newcommand{\msL}{\mathscr L} 
\newcommand{\msM}{\mathscr M} 
\newcommand{\msN}{\mathscr N} 
\newcommand{\msO}{\mathscr O} 
\newcommand{\msP}{\mathscr P} 
\newcommand{\msQ}{\mathscr Q} 
\newcommand{\msR}{\mathscr R} 
\newcommand{\msS}{\mathscr S} 
\newcommand{\msT}{\mathscr T} 
\newcommand{\msU}{\mathscr U} 
\newcommand{\msV}{\mathscr V} 
\newcommand{\msW}{\mathscr W} 
\newcommand{\msX}{\mathscr X} 
\newcommand{\msY}{\mathscr Y} 
\newcommand{\msZ}{\mathscr Z}

% Geometry
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle}
\newcommand{\ray}[1]{\overrightarrow{#1}} 
\newcommand{\seg}[1]{\overline{#1}}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\wideparen}{\mathord}{yhlargesymbols}{"F3}
\newcommand{\arc}[1]{\wideparen{#1}}

% Custom enumerates
\newenvironment{anum}{ % (a), (b), ...
\begin{enumerate}[label = (\alph*)]}{\end{enumerate}}
\newenvironment{Rnum}{ % (I), (II), ...
\begin{enumerate}[label = (\Roman*)]}{\end{enumerate}}
\newenvironment{rnum}{ % (i), (ii), ...
\begin{enumerate}[label = (\roman*)]}{\end{enumerate}}

\newenvironment{myenum}{% no space
    \begin{enumerate}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{enumerate}}

\newenvironment{boldenum}{%
    \begin{enumerate}[label=\textbf{\arabic*.}]
}{\end{enumerate}}

\newenvironment{myitem}{% no space
    \begin{itemize}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{itemize}}

% Custom footnote
\@ifundefined{KOMAClassName}{}
{\renewcommand{\thefootnote}{\fnsymbol{footnote}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%         HYPERREF          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{astral}{RGB}{46,116,181}
\hypersetup{
    colorlinks,
    citecolor=astral,
    filecolor=astral,
    linkcolor=black,
    urlcolor=astral
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%            PAGE SETUP            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifprestonsetlinespacing
    \ifprestonnoindent
        \setlength{\parindent}{0pt}
    \fi
    \setlength{\parskip}{0.6ex}
    \renewcommand{\baselinestretch}{1.05}
\fi

\ifprestonmarginset
    \setlength{\headheight}{16pt}
    \setlength{\headsep}{10pt}
\fi

\ifprestonpazo
    \usepackage{mathpazo}
\fi

\ifprestonroboto
    \usepackage{roboto}
\fi

\@ifundefined{KOMAClassName}
{
    \ifprestonmarginset
        \usepackage[margin=1in]{geometry}
    \fi
    
    \ifprestonfancy
        \usepackage{fancyhdr}
        \pagestyle{fancy}
        \fancyhf{}
        \ifprestonbook
            \renewcommand\chaptermark[1]{\markboth{\thechapter. #1}{}}
            \fancyhead[LO]{\nouppercase{\rightmark}}
            \fancyhead[RE]{\nouppercase{\leftmark}}
            \fancyhead[LE,RO]{\thepage}
            \renewcommand{\headrulewidth}{0pt}
        \else
            \lhead{\thetitle}
            \rhead{\theauthor}
            \cfoot{\thepage}
            \renewcommand{\headrulewidth}{0.5pt}
        \fi
    \fi
}
{
    \ifprestonmarginset
        \usepackage[margin=1in]{geometry}
		\setlength{\footskip}{0.5in}
	\fi
	
    \ifprestonfancy
        \ifprestonbook
            \usepackage{scrlayer-scrpage}
            \renewcommand\chaptermark[1]{\markboth{\thechapter. #1}{}}
            \renewcommand*{\headfont}{\bfseries\sffamily}
            \renewcommand*{\pnumfont}{\bfseries\sffamily}
            \ohead{\pagemark}
            \ofoot{}
            \cfoot{}
            \ihead{\headmark}
        \else
            \usepackage[headsepline]{scrlayer-scrpage}
			\renewcommand{\headfont}{}
			\ifprestonmarginset
    			\usepackage[margin=1in]{geometry}
    			\setlength{\footskip}{0.5in}
    		\fi
			\ihead{\small\textbf{\theauthor} (\thedate)}
			\automark{section}
			\chead{}
			\ohead{\small\textbf{\thetitle}}
			\cfoot{\pagemark}
        \fi
    \fi

    \addtokomafont{subtitle}{\Large}
    \setkomafont{author}{\large}
    \setkomafont{date}{\large}
    
    \@ifundefined{chapter}{}{
        \addtokomafont{part}{\headingfont}
        \addtokomafont{chapter}{\headingfont}
    }
    \addtokomafont{section}{\headingfont}
    \addtokomafont{subsection}{\headingfont}
    \addtokomafont{subsubsection}{\headingfont}
    
    \@ifundefined{KOMAClassName}{}{
		\KOMAoptions{numbers=noenddot}
		\usepackage[tocindentauto]{tocstyle}
		\usetocstyle{KOMAlike}
		
        \ifprestoncolor
    	    \@ifundefined{chapter}{}{
    			\addtokomafont{partprefix}{\rmfamily}
    			\renewcommand*{\partformat}{\color{NavyBlue}
    				\scalebox{2.5}{\thepart}\enlargethispage{2em}}
    			\addtokomafont{chapterprefix}{\raggedleft}
    			\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
    			\renewcommand*{\chapterformat}{\mbox{%
    				\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
    				\scalebox{2.718}{\color{NavyBlue}\thechapter}\enskip}}
    		}
            \ifprestonfancysec
        		\renewcommand*{\sectionformat}{\color{NavyBlue}\S\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\color{NavyBlue}\S\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\color{NavyBlue}\S\thesubsubsection\enskip}
        	\else
        		\renewcommand*{\sectionformat}{\color{NavyBlue}\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\color{NavyBlue}\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\color{NavyBlue}\thesubsubsection\enskip}
        	\fi
    	\else
    	    \ifprestonfancysec
        	    \@ifundefined{chapter}{}{
        			\addtokomafont{partprefix}{\rmfamily}
        			\renewcommand*{\partformat}{
        				\scalebox{2.5}{\thepart}\enlargethispage{2em}}
        			\addtokomafont{chapterprefix}{\raggedleft}
        			\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
        			\renewcommand*{\chapterformat}{\mbox{%
        				\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
        				\scalebox{2.718}{\thechapter}\enskip}}
        		}
        		\renewcommand*{\sectionformat}{\S\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\S\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\S\thesubsubsection\enskip}
        	\fi
		\fi
	}
}

\ifprestonindex
    \makeindex[columns=2,intoc]
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          THEOREMS         %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Box names for monochrome and nocolor are stupid but preserve style.
%% Blue and black make theorem and remark-styled boxes (resp.),
%% while other ones do definition-style boxes with various colors.

\ifprestonmdthm
	
    \ifprestoncolor
    
        \mdfdefinestyle{mdbluebox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=NavyBlue,
    		backgroundcolor=TealBlue!5,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{NavyBlue},
    		bodyfont=\itshape,
    		mdframed={style=mdbluebox},
    		headpunct={. },
    		postheadspace={0pt}
    	]{thmbluebox}
    	
    	\mdfdefinestyle{mdgreenbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=ForestGreen,
    		backgroundcolor=ForestGreen!5,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{ForestGreen},
    		mdframed={style=mdgreenbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmgreenbox}
    	
    	\mdfdefinestyle{mdorangebox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=orange,
    		backgroundcolor=Crimson!4,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{orange},
    		mdframed={style=mdorangebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmorangebox}
    	
    	\mdfdefinestyle{mdbrownbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=RawSienna,
    		backgroundcolor=Salmon!5,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{RawSienna},
    		mdframed={style=mdbrownbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmbrownbox}
    	
    	\mdfdefinestyle{mdredbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=BrickRed,
    		backgroundcolor=VioletRed!5,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{BrickRed},
    		mdframed={style=mdredbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmredbox}
    	
    	\mdfdefinestyle{mdblackbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=black,
    		backgroundcolor=RedViolet!5!gray!5,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\itshape\sansfont,
    		mdframed={style=mdblackbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmblackbox}
    	
    	\mdfdefinestyle{mdpurplebox}{%
    		skipabove=8pt,
    		linewidth=0pt,
    		rightline=false,
    		leftline=false,
    		topline=false,
    		bottomline=false,
    		linecolor=RoyalPurple,
    		backgroundcolor=Plum!10,
    		innertopmargin=8pt,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{RoyalPurple},
    		mdframed={style=mdpurplebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmpurplebox}

    	\mdfdefinestyle{mdgraybox}{%
    		skipabove=8pt,
    		linewidth=0pt,
    		backgroundcolor=Gray!20,
    		innertopmargin=8pt,
    	}
    	
    \else

    	\mdfdefinestyle{mdgraybox}{%
    		skipabove=8pt,
    		linewidth=0.5pt,
    		backgroundcolor=Gray!20,
    		innertopmargin=8pt,
    	}
	
        \ifprestonmonochrome
        
            \declaretheoremstyle[
        		headfont=\headingfont,
        		bodyfont=\itshape,
        		mdframed={style=mdgraybox},
        		headpunct={. },
        		postheadspace={0pt}
        	]{thmgraythmbox}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		mdframed={style=mdgraybox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmgraydefbox}
        
        	\declaretheoremstyle[
        		headfont=\itshape\headingfont,
        		mdframed={style=mdgraybox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmgrayrembox}
        \fi
    \fi

	\declaretheoremstyle[
		headfont=\headingfont,
		mdframed={style=mdgraybox},
		headpunct={. },
		postheadspace={0pt},
	]{thmgraybox}
	
	\mdfdefinestyle{mdwhitebox}{%
		skipabove=8pt,
		linewidth=0.5pt,
		innertopmargin=8pt,
	}
	
	\declaretheoremstyle[
		headfont=\headingfont,
		bodyfont=\itshape,
		mdframed={style=mdwhitebox},
		headpunct={. },
		postheadspace={0pt},
		spaceabove=2pt,
		spacebelow=1pt
	]{thmwhitethmbox}
	
	\declaretheoremstyle[
		headfont=\headingfont,
		mdframed={style=mdwhitebox},
		headpunct={. },
		postheadspace={0pt},
		spaceabove=2pt,
		spacebelow=1pt
	]{thmwhitedefbox}
	
	\declaretheoremstyle[
		headfont=\headingfont,
		mdframed={style=mdwhitebox},
		headpunct={. },
		postheadspace={0pt},
		spaceabove=2pt,
		spacebelow=1pt
	]{thmwhiterembox}
\fi

\ifprestonmdthm

    \ifprestoncolor
    
        \theoremstyle{plain}
        
        \ifprestonchthm
            \declaretheorem[style=thmbluebox,name=Theorem,numberwithin=chapter]{thm}
    	\else
        	\ifprestonsecthm
        		\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{thm}
        	\else
        		\declaretheorem[style=thmbluebox,name=Theorem]{thm}
        	\fi
    	\fi
    	\declaretheorem[style=thmbluebox,name=Lemma,sibling=thm]{lemma}
    	\declaretheorem[style=thmbluebox,name=Lemma]{ilemma}
    	\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{prop}
    	\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{cor}
    	
        \declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{thm*}
    	\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
    	\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{prop*}
    	\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{cor*}
    	
        \theoremstyle{definition}
    
        \ifprestonchthm
            \declaretheorem[name=Problem,numberwithin=chapter]{prob}
        \else
            \ifprestonsecthm
            	\declaretheorem[name=Problem,numberwithin=section]{prob}
            \else
                \declaretheorem[name=Problem]{prob}
            \fi
        \fi
        \declaretheorem[name=Problem,numbered=no]{prob*}
        
    	\declaretheorem[style=thmgreenbox,name=Problem,sibling=prob]{boxprob}
        \declaretheorem[style=thmbrownbox,name=Example,sibling=thm]{ex}
    	\declaretheorem[style=thmorangebox,name=Claim,sibling=thm]{claim}
    	\declaretheorem[style=thmorangebox,name=Claim]{iclaim}
    	
    	\declaretheorem[style=thmgreenbox,name=Problem,numbered=no]{boxprob*}
    	\declaretheorem[style=thmorangebox,name=Claim,numbered=no]{claim*}
        \declaretheorem[style=thmbrownbox,name=Example,numbered=no]{ex*}
        \declaretheorem[style=thmredbox,name=Concept,numbered=no]{concept}
    	\declaretheorem[style=thmpurplebox,name=Warning,numbered=no]{warn}
    	
        \declaretheorem[style=thmpurplebox,name=Bogus Solution,numbered=no]{bogussol}
        \declaretheorem[style=thmpurplebox,name=Bogus Proof,numbered=no]{boguspf}
        \declaretheorem[style=thmgraybox,name=Solution,numbered=no]{boxsol}
        \declaretheorem[style=thmgraybox,name=Proof,numbered=no]{boxpf}
    	
    	\theoremstyle{remark}
    	\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark}
    	
    \else \ifprestonmonochrome
    
    \theoremstyle{plain}
        
        \ifprestonchthm
            \declaretheorem[style=thmgraythmbox,name=Theorem,numberwithin=chapter]{thm}
    	\else
        	\ifprestonsecthm
        		\declaretheorem[style=thmgraythmbox,name=Theorem,numberwithin=section]{thm}
        	\else
        		\declaretheorem[style=thmgraythmbox,name=Theorem]{thm}
        	\fi
    	\fi
    	\declaretheorem[style=thmgraythmbox,name=Lemma,sibling=thm]{lemma}
    	\declaretheorem[style=thmgraythmbox,name=Lemma]{ilemma}
    	\declaretheorem[style=thmgraythmbox,name=Proposition,sibling=thm]{prop}
    	\declaretheorem[style=thmgraythmbox,name=Corollary,sibling=thm]{cor}
    	
        \declaretheorem[style=thmgraythmbox,name=Theorem,numbered=no]{thm*}
    	\declaretheorem[style=thmgraythmbox,name=Lemma,numbered=no]{lemma*}
    	\declaretheorem[style=thmgraythmbox,name=Proposition,numbered=no]{prop*}
    	\declaretheorem[style=thmgraythmbox,name=Corollary,numbered=no]{cor*}
    	
        \theoremstyle{definition}
    
        \ifprestonchthm
            \declaretheorem[name=Problem,numberwithin=chapter]{prob}
        \else
            \ifprestonsecthm
            	\declaretheorem[name=Problem,numberwithin=section]{prob}
            \else
                \declaretheorem[name=Problem]{prob}
            \fi
        \fi
        \declaretheorem[name=Problem,numbered=no]{prob*}
        
    	\declaretheorem[style=thmgraydefbox,name=Problem,sibling=prob]{boxprob}
        \declaretheorem[style=thmgraydefbox,name=Example,sibling=thm]{ex}
    	\declaretheorem[style=thmgraydefbox,name=Claim,sibling=thm]{claim}
    	\declaretheorem[style=thmgraydefbox,name=Claim]{iclaim}
    	
    	\declaretheorem[style=thmgraydefbox,name=Problem,numbered=no]{boxprob*}
    	\declaretheorem[style=thmgraydefbox,name=Claim,numbered=no]{claim*}
        \declaretheorem[style=thmgraydefbox,name=Example,numbered=no]{ex*}
        \declaretheorem[style=thmgraydefbox,name=Concept,numbered=no]{concept}
    	\declaretheorem[style=thmgraydefbox,name=Warning,numbered=no]{warn}
    	
        \declaretheorem[style=thmgraydefbox,name=Bogus Solution,numbered=no]{bogussol}
        \declaretheorem[style=thmgraydefbox,name=Bogus Proof,numbered=no]{boguspf}
        \declaretheorem[style=thmgraydefbox,name=Solution,numbered=no]{boxsol}
        \declaretheorem[style=thmgraydefbox,name=Proof,numbered=no]{boxpf}
    	
    	\theoremstyle{remark}
    	\declaretheorem[style=thmgrayrembox,name=Remark,numbered=no]{remark}
    	
    \else
    
        \theoremstyle{plain}
        
        \ifprestonchthm
            \declaretheorem[style=thmwhitethmbox,name=Theorem,numberwithin=chapter]{thm}
    	\else
        	\ifprestonsecthm
        		\declaretheorem[style=thmwhitethmbox,name=Theorem,numberwithin=section]{thm}
        	\else
        		\declaretheorem[style=thmwhitethmbox,name=Theorem]{thm}
        	\fi
    	\fi
    	\declaretheorem[style=thmwhitethmbox,name=Lemma,sibling=thm]{lemma}
    	\declaretheorem[style=thmwhitethmbox,name=Lemma]{ilemma}
    	\declaretheorem[style=thmwhitethmbox,name=Proposition,sibling=thm]{prop}
    	\declaretheorem[style=thmwhitethmbox,name=Corollary,sibling=thm]{cor}
    	
        \declaretheorem[style=thmwhitethmbox,name=Theorem,numbered=no]{thm*}
    	\declaretheorem[style=thmwhitethmbox,name=Lemma,numbered=no]{lemma*}
    	\declaretheorem[style=thmwhitethmbox,name=Proposition,numbered=no]{prop*}
    	\declaretheorem[style=thmwhitethmbox,name=Corollary,numbered=no]{cor*}
    	
        \theoremstyle{definition}
    
        \ifprestonchthm
            \declaretheorem[name=Problem,numberwithin=chapter]{prob}
        \else
            \ifprestonsecthm
            	\declaretheorem[name=Problem,numberwithin=section]{prob}
            \else
                \declaretheorem[name=Problem]{prob}
            \fi
        \fi
        \declaretheorem[style=thmwhitedefbox,name=Example,sibling=thm]{ex}
        \declaretheorem[name=Problem,numbered=no]{prob*}
        \declaretheorem[style=thmwhitedefbox,name=Example,numbered=no]{ex*}
        
    	\declaretheorem[style=thmwhitedefbox,name=Problem,sibling=prob]{boxprob}
    	\declaretheorem[style=thmwhitedefbox,name=Claim,sibling=thm]{claim}
    	\declaretheorem[style=thmwhitedefbox,name=Claim]{iclaim}
    	\declaretheorem[style=thmwhitedefbox,name=Problem,numbered=no]{boxprob*}
    	\declaretheorem[style=thmwhitedefbox,name=Claim,numbered=no]{claim*}
    	\declaretheorem[style=thmwhitedefbox,name=Concept,numbered=no]{concept}
    	\declaretheorem[style=thmwhitedefbox,name=Warning,numbered=no]{warn}
    	
        \declaretheorem[style=thmwhitedefbox,name=Bogus Solution,numbered=no]{bogussol}
        \declaretheorem[style=thmwhitedefbox,name=Bogus Proof,numbered=no]{boguspf}
        \declaretheorem[style=thmwhitedefbox,name=Solution,numbered=no]{boxsol}
        \declaretheorem[style=thmwhitedefbox,name=Proof,numbered=no]{boxpf}
    	
    	\theoremstyle{remark}
    	\declaretheorem[style=thmwhiterembox,name=Remark,numbered=no]{remark}
    \fi
    \fi
\else
    \theoremstyle{plain}
    
    \ifprestonchthm
        \declaretheorem[name=Theorem,numberwithin=chapter]{thm}
	\else
    	\ifprestonsecthm
    		\declaretheorem[name=Theorem,numberwithin=section]{thm}
    	\else
    		\declaretheorem[name=Theorem]{thm}
    	\fi
	\fi
	\declaretheorem[name=Lemma,sibling=thm]{lemma}
	\declaretheorem[name=Lemma]{ilemma}
	\declaretheorem[name=Proposition,sibling=thm]{prop}
	\declaretheorem[name=Corollary,sibling=thm]{cor}
	
	\declaretheorem[name=Theorem,numbered=no]{thm*}
	\declaretheorem[name=Lemma,numbered=no]{lemma*}
	\declaretheorem[name=Proposition,numbered=no]{prop*}
	\declaretheorem[name=Corollary,numbered=no]{cor*}
	
	\theoremstyle{definition}
    
    \ifprestonchthm
        \declaretheorem[name=Problem,numberwithin=chapter]{prob}
    \else
        \ifprestonsecthm
        	\declaretheorem[name=Problem,numberwithin=section]{prob}
        \else
            \declaretheorem[name=Problem]{prob}
        \fi
    \fi
    \declaretheorem[name=Example,sibling=thm]{ex}
    \declaretheorem[name=Problem,numbered=no]{prob*}
    \declaretheorem[name=Example,numbered=no]{ex*}
    
	\declaretheorem[name=Claim,sibling=thm]{claim}
	\declaretheorem[name=Claim]{iclaim}
	\declaretheorem[name=Claim,numbered=no]{claim*}
	\declaretheorem[name=Concept,numbered=no]{concept}
	\declaretheorem[name=Warning,numbered=no]{warn}
	
	 \newenvironment{bogussol}[1][Bogus Solution] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}
    \newenvironment{boguspf}[1][Bogus Proof] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}
	
	\theoremstyle{remark}
	\declaretheorem[name=Remark,numbered=no]{remark}
\fi

%% Non-MD-style

\theoremstyle{definition}

\declaretheorem[name=Definition,sibling=thm]{defn}
\declaretheorem[name=Conjugate,sibling=thm]{conj}
\declaretheorem[name=Fact,sibling=thm]{fact}
\declaretheorem[name=Answer,sibling=prob]{fakeanswer}
\newenvironment{answer}{
    \addtocounter{prob}{-1}
    \begin{fakeanswer}
}{\end{fakeanswer}}

\declaretheorem[name=Definition,numbered=no]{defn*}
\declaretheorem[name=Conjugate,numbered=no]{conj*}
\declaretheorem[name=Fact,numbered=no]{fact*}
\declaretheorem[name=Question,numbered=no]{question}
\declaretheorem[name=Answer,numbered=no]{answer*}
\declaretheorem[name=Notation,numbered=no]{notation}
\declaretheorem[name=Upshot,numbered=no]{upshot}

\theoremstyle{remark}

\declaretheorem[name=Note,numbered=no]{note}
\declaretheorem[name=Exercise,numbered=no]{exer}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%           HINT           %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{hints}{\footnotesize \normalfont \textbf{Hints: }}{\hspace{-0.5ex}}
\newenvironment{hint}{\footnotesize \normalfont \textbf{Hint: }}{\hspace{-0.5ex}}

\ifprestonfancyhint %% Evan Chen
    \usepackage{etoolbox}
    \usepackage{tikz}
    \usepackage{ifthen}
    \usepackage{answers}
    
    \newcounter{hindex}\setcounter{hindex}{0}
    \newcounter{hintcounter}\setcounter{hintcounter}{0}
    
    \newcommand{\addhint}[1]{%
    	\stepcounter{hintcounter}%
    	\ref{hint:\thehintcounter}%
    	\expandafter\gdef\csname hintlist\thehintcounter\endcsname{#1}%
    }
    \newcommand\gethint[1]{\item \csname hintlist#1\endcsname \label{hint:#1}}
\else
    \newcommand{\addhint}[1]{#1}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          PROOFS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand\qedsymbol{$\blacksquare$}

\ifprestonqednow
    \renewenvironment{proof}[1][\proofname]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{sol}[1][Solution]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
\else
    \newenvironment{sol}[1][Solution] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
\fi 

\newenvironment{subproof}[1][\proofname]{\renewcommand{\qedsymbol}{$\Box$}\begin{proof}[#1]}{\end{proof}}
\newenvironment{progress}[1][Progress] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%          ASYMPTOTE          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[inline]{asymptote}
\begin{asydef}
    import olympiad;
	usepackage("bm");
    usepackage("amsmath");
	usepackage("amssymb");
	defaultpen(fontsize(11pt));
\end{asydef}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%           CODE            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
    language=C++,
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=flexible,
    basicstyle={\small\ttfamily},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
    stringstyle=\color{mauve},
    breaklines=true,
    breakatwhitespace=true,
    tabsize=4,
    frame=single
}
