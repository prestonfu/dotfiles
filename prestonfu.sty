%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% prestonfu.sty - Copyright Preston Fu 2020                        %
% Thanks to Evan Chen and Eric Shen                                %
% https://github.com/prestonfu/dotfiles/blob/master/prestonfu.sty  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{prestonfu}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          OPTIONS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newif\ifprestonmdthm\prestonmdthmfalse
\newif\ifprestoncolor\prestoncolortrue
\newif\ifprestonmonochrome\prestonmonochromefalse
\newif\ifprestonchthm\prestonchthmfalse
\newif\ifprestonbook\prestonbookfalse
\newif\ifprestonsecthm\prestonsecthmtrue
\newif\ifprestonfancysec\prestonfancysectrue
\newif\ifprestonfancy\prestonfancytrue
\newif\ifprestonqednow\prestonqednowfalse
\newif\ifprestonpazo\prestonpazofalse
\newif\ifprestonroboto\prestonrobotofalse
\newif\ifprestonsetlinespacing\prestonsetlinespacingtrue
\newif\ifprestonnoindent\prestonnoindentfalse
\newif\ifprestonmarginset\prestonmarginsettrue
\newif\ifprestonindex\prestonindexfalse

\DeclareOption{mdthm}{\prestonmdthmtrue}
\DeclareOption{nomdthm}{\prestonmdthmfalse}
\DeclareOption{color}{\prestoncolortrue}
\DeclareOption{nocolor}{\prestoncolorfalse}
\DeclareOption{monochrome}{\prestoncolorfalse\prestonmonochrometrue}
\DeclareOption{secthm}{\prestonsecthmtrue}
\DeclareOption{nosecthm}{\prestonsecthmfalse}
\DeclareOption{chthm}{\prestonchthmtrue}
\DeclareOption{book}{\prestonbooktrue}
\DeclareOption{fancysec}{\prestonfancysectrue}
\DeclareOption{nofancysec}{\prestonfancysecfalse}
\DeclareOption{fancy}{\prestonfancytrue}
\DeclareOption{nofancy}{\prestonfancyfalse}
\DeclareOption{qednow}{\prestonqednowtrue}
\DeclareOption{pazo}{\prestonpazotrue}
\DeclareOption{roboto}{\prestonrobototrue}
\DeclareOption{noindent}{\prestonnoindenttrue}
\DeclareOption{nomarginset}{\prestonmarginsetfalse}
\DeclareOption{index}{\prestonindextrue}

\@ifundefined{KOMAClassName}{
    \newcommand{\headingfont}{\bfseries}
    \newcommand{\sansfont}{\normalfont}
    \prestoncolorfalse
    \prestonfancytrue
}{
    \newcommand{\headingfont}{\sffamily\bfseries}
    \newcommand{\sansfont}{\sffamily}
    \prestonmdthmtrue
}

\DeclareOption{ams}{
    \prestoncolorfalse
    \prestonfancyfalse
}

\ProcessOptions\relax

\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{amsthm}
\usepackage{thmtools}
\PassOptionsToPackage{usenames,svgnames,dvipsnames}{xcolor}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[english]{babel}
\usepackage{mathdots}
\usepackage[final]{pdfpages}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{epigraph}
\usepackage{hyperref}
\usepackage{mathrsfs}
\usepackage{textcomp}
\usepackage{appendix}
\usepackage{imakeidx}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%      USEFUL COMMANDS      %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\dotp}{\boldsymbol{\cdot}}
\newcommand{\x}{\times}
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\braces}[1]{\left \{ #1 \right \}}
\newcommand{\set}[1]{\left \{ #1 \right \}}
\newcommand{\parens}[1]{\left( #1 \right)}
\newcommand{\brackets}[1]{\left[ #1 \right]}
\newcommand{\angleb}[1]{\left\langle #1 \right\rangle}
\newcommand{\pfrac}[2]{\parens{\frac{#1}{#2}}}
\newcommand{\mailto}[1]{\href{mailto:#1}{\texttt{#1}}}
\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\eps}{\varepsilon}
\renewcommand{\deg}{^\circ}
\renewcommand{\bold}[1]{{\boldmath\bfseries #1}}
\ifprestoncolor
    \newcommand{\vocab}[1]{\bold{\color{NavyBlue} #1}}
\else
    \newcommand{\vocab}[1]{\bold{#1}}
\fi
\newcommand{\hrulebar}{\begin{center}\nointerlineskip\vspace{5pt}\rule{\textwidth}{.7pt}\hspace{\fill}\end{center}}
\newcommand{\ans}[5]{\textbf{(A) }#1\qquad\textbf{(B) }#2\qquad\textbf{(C) }#3\qquad\textbf{(D) }#4\qquad\textbf{(E) }#5}
\newcommand{\id}{\mathrm{id}}
\newcommand{\inv}{^{-1}}

\DeclareMathOperator*{\lcm}{lcm}
\DeclareMathOperator*{\Re}{Re}
\DeclareMathOperator*{\Im}{Im}
\DeclareMathOperator*{\Pow}{Pow}
\DeclareMathOperator*{\diam}{diam}
\DeclareMathOperator*{\mesh}{mesh}
\DeclareMathOperator*{\ord}{ord}
\DeclareMathOperator*{\adj}{adj}
\DeclareMathOperator*{\cur}{curl}
\DeclareMathOperator*{\die}{div}
\DeclareMathOperator*{\cis}{cis}
\DeclareMathOperator*{\rank}{rank}
\DeclareMathOperator*{\Spec}{Spec}
\DeclareMathOperator*{\Tr}{Tr]
\DeclareMathOperator*{\Dom}{Dom}
\DeclareMathOperator*{\Rng}{Rng}
\DeclareMathOperator*{\im}{im}
\DeclareMathOperator*{\Aut}{Aut}
\DeclareMathOperator*{\Inn}{Inn}

\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

\newcommand{\CC}{\mathbb C}
\newcommand{\EE}{\mathbb E}
\newcommand{\FF}{\mathbb F}
\newcommand{\HH}{\mathbb H}
\newcommand{\NN}{\mathbb N}
\newcommand{\PP}{\mathbb P}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\TT}{\mathbb T}
\newcommand{\RR}{\mathbb R}
\newcommand{\UU}{\mathbb U}
\newcommand{\ZZ}{\mathbb Z}
\newcommand{\Qbar}{\overline{\QQ}}
\newcommand{\Zbar}{\overline{\ZZ}}
\newcommand{\ii}{\mathbf i}
\newcommand{\jj}{\mathbf j}
\newcommand{\kk}{\mathbf k}

\newcommand{\mfb}{\mathfrak b}
\newcommand{\mfg}{\mathfrak g}
\newcommand{\mfh}{\mathfrak h}
\newcommand{\mfm}{\mathfrak m}
\newcommand{\mfn}{\mathfrak n}
\newcommand{\mfp}{\mathfrak p}
\newcommand{\mfq}{\mathfrak q}
\newcommand{\mfu}{\mathfrak u}
\newcommand{\mfz}{\mathfrak z}

\newcommand{\mcA}{\mathcal A} 
\newcommand{\mcB}{\mathcal B} 
\newcommand{\mcC}{\mathcal C} 
\newcommand{\mcD}{\mathcal D} 
\newcommand{\mcE}{\mathcal E} 
\newcommand{\mcF}{\mathcal F} 
\newcommand{\mcG}{\mathcal G} 
\newcommand{\mcH}{\mathcal H} 
\newcommand{\mcI}{\mathcal I} 
\newcommand{\mcJ}{\mathcal J} 
\newcommand{\mcK}{\mathcal K} 
\newcommand{\mcL}{\mathcal L} 
\newcommand{\mcM}{\mathcal M} 
\newcommand{\mcN}{\mathcal N} 
\newcommand{\mcO}{\mathcal O} 
\newcommand{\mcP}{\mathcal P} 
\newcommand{\mcQ}{\mathcal Q} 
\newcommand{\mcR}{\mathcal R} 
\newcommand{\mcS}{\mathcal S} 
\newcommand{\mcT}{\mathcal T} 
\newcommand{\mcU}{\mathcal U} 
\newcommand{\mcV}{\mathcal V} 
\newcommand{\mcW}{\mathcal W} 
\newcommand{\mcX}{\mathcal X} 
\newcommand{\mcY}{\mathcal Y} 
\newcommand{\mcZ}{\mathcal Z}

\newcommand{\msA}{\mathscr A} 
\newcommand{\msB}{\mathscr B} 
\newcommand{\msC}{\mathscr C} 
\newcommand{\msD}{\mathscr D} 
\newcommand{\msE}{\mathscr E} 
\newcommand{\msF}{\mathscr F} 
\newcommand{\msG}{\mathscr G} 
\newcommand{\msH}{\mathscr H} 
\newcommand{\msI}{\mathscr I} 
\newcommand{\msJ}{\mathscr J} 
\newcommand{\msK}{\mathscr K} 
\newcommand{\msL}{\mathscr L} 
\newcommand{\msM}{\mathscr M} 
\newcommand{\msN}{\mathscr N} 
\newcommand{\msO}{\mathscr O} 
\newcommand{\msP}{\mathscr P} 
\newcommand{\msQ}{\mathscr Q} 
\newcommand{\msR}{\mathscr R} 
\newcommand{\msS}{\mathscr S} 
\newcommand{\msT}{\mathscr T} 
\newcommand{\msU}{\mathscr U} 
\newcommand{\msV}{\mathscr V} 
\newcommand{\msW}{\mathscr W} 
\newcommand{\msX}{\mathscr X} 
\newcommand{\msY}{\mathscr Y} 
\newcommand{\msZ}{\mathscr Z}

\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle}
\newcommand{\ray}[1]{\overrightarrow{#1}} 
\newcommand{\seg}[1]{\overline{#1}}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\wideparen}{\mathord}{yhlargesymbols}{"F3}
\newcommand{\arc}[1]{\wideparen{#1}}

\newenvironment{anum}{ % (a), (b), ...
\begin{enumerate}[label = (\alph*)]}{\end{enumerate}}
\newenvironment{Rnum}{ % (I), (II), ...
\begin{enumerate}[label = (\Roman*)]}{\end{enumerate}}
\newenvironment{rnum}{ % (i), (ii), ...
\begin{enumerate}[label = (\roman*)]}{\end{enumerate}}

\newenvironment{myenum}{% no space
    \begin{enumerate}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{enumerate}}

\newenvironment{boldenum}{%
    \begin{enumerate}[label=\textbf{\arabic*.}]
}{\end{enumerate}}

\newenvironment{myitem}{% no space
    \begin{itemize}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{itemize}}

% Custom footnote
\@ifundefined{KOMAClassName}{}
{\renewcommand{\thefootnote}{\fnsymbol{footnote}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%         HYPERREF          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{astral}{RGB}{46,116,181}
\hypersetup{
    colorlinks,
    citecolor=astral,
    filecolor=astral,
    linkcolor=black,
    urlcolor=astral
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%            PAGE SETUP            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifprestonsetlinespacing
    \ifprestonnoindent
        \setlength{\parindent}{0pt}
        \setlength{\parskip}{0.3ex}
    \fi
    \renewcommand{\baselinestretch}{1.05}
\fi

\ifprestonmarginset
    \setlength{\headheight}{16pt}
    \setlength{\headsep}{10pt}
\fi

\ifprestonpazo
    \usepackage{mathpazo}
\fi

\ifprestonroboto
    \usepackage{roboto}
\fi

\@ifundefined{KOMAClassName}
{
    \ifprestonmarginset
        \usepackage[margin=1in]{geometry}
    \fi
    \ifprestonfancy
        \usepackage{fancyhdr}
        \pagestyle{fancy}
        \fancyhf{}
        \ifprestonbook
            \renewcommand\chaptermark[1]{\markboth{\thechapter. #1}{}}
            \fancyhead[LO]{\nouppercase{\rightmark}}
            \fancyhead[RE]{\nouppercase{\leftmark}}
            \fancyhead[LE,RO]{\thepage}
            \renewcommand{\headrulewidth}{0pt}
        \else
            \lhead{\thetitle}
            \rhead{\theauthor}
            \cfoot{\thepage}
            \renewcommand{\headrulewidth}{0.5pt}
        \fi
    \fi
}
{
    \ifprestonfancy
        \ifprestonbook
            \usepackage{scrlayer-scrpage}
            \ifprestonmarginset
                \usepackage[margin=1in]{geometry}
    			\setlength{\footskip}{0.5in}
    		\fi
            \renewcommand\chaptermark[1]{\markboth{\thechapter. #1}{}}
            \renewcommand*{\headfont}{\bfseries\sffamily}
            \renewcommand*{\pnumfont}{\bfseries\sffamily}
            \ohead{\pagemark}
            \ofoot{}
            \cfoot{}
            \ihead{\headmark}
        \else
            \usepackage[headsepline]{scrlayer-scrpage}
			\renewcommand{\headfont}{}
			\ifprestonmarginset
    			\usepackage[margin=1in]{geometry}
    			\setlength{\footskip}{0.5in}
    		\fi
			\ihead{\small\textbf{\theauthor} (\thedate)}
			\automark{section}
			\chead{}
			\ohead{\small\textbf{\thetitle}}
			\cfoot{\pagemark}
        \fi
    \fi

    \addtokomafont{subtitle}{\Large}
    \setkomafont{author}{\large}
    \setkomafont{date}{\large}
    
    \@ifundefined{chapter}{}{
        \addtokomafont{part}{\headingfont}
        \addtokomafont{chapter}{\headingfont}
    }
    \addtokomafont{section}{\headingfont}
    \addtokomafont{subsection}{\headingfont}
    \addtokomafont{subsubsection}{\headingfont}
    
    \@ifundefined{KOMAClassName}{}{
		\KOMAoptions{numbers=noenddot}
		\usepackage[tocindentauto]{tocstyle}
		\usetocstyle{KOMAlike}
		
        \ifprestoncolor
    	    \@ifundefined{chapter}{}{
    			\addtokomafont{partprefix}{\rmfamily}
    			\renewcommand*{\partformat}{\color{NavyBlue}
    				\scalebox{2.5}{\thepart}\enlargethispage{2em}}
    			\addtokomafont{chapterprefix}{\raggedleft}
    			\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
    			\renewcommand*{\chapterformat}{\mbox{%
    				\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
    				\scalebox{2.718}{\color{NavyBlue}\thechapter}\enskip}}
    		}
            \ifprestonfancysec
        		\renewcommand*{\sectionformat}{\color{NavyBlue}\S\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\color{NavyBlue}\S\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\color{NavyBlue}\S\thesubsubsection\enskip}
        	\else
        		\renewcommand*{\sectionformat}{\color{NavyBlue}\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\color{NavyBlue}\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\color{NavyBlue}\thesubsubsection\enskip}
        	\fi
    	\else
    	    \ifprestonfancysec
        	    \@ifundefined{chapter}{}{
        			\addtokomafont{partprefix}{\rmfamily}
        			\renewcommand*{\partformat}{
        				\scalebox{2.5}{\thepart}\enlargethispage{2em}}
        			\addtokomafont{chapterprefix}{\raggedleft}
        			\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
        			\renewcommand*{\chapterformat}{\mbox{%
        				\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
        				\scalebox{2.718}{\thechapter}\enskip}}
        		}
        		\renewcommand*{\sectionformat}{\S\thesection\enskip}
        		\renewcommand*{\subsectionformat}{\S\thesubsection\enskip}
        		\renewcommand*{\subsubsectionformat}{\S\thesubsubsection\enskip}
        	\fi
		\fi
	}
}

\ifprestonindex
    \makeindex[columns=2,intoc]
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          THEOREMS         %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Box names for monochrome and nocolor are stupid but preserve style.
%% Blue and black make theorem and remark-styled boxes (resp.),
%% while other ones do definition-style boxes with various colors.

\ifprestonmdthm

	\mdfdefinestyle{mdgraybox}{%
		skipabove=8pt,
		linewidth=0.5pt,
		backgroundcolor=Gray!20,
	}

	\declaretheoremstyle[
		headfont=\headingfont,
		mdframed={style=mdgraybox},
		headpunct={. },
		postheadspace={0pt},
	]{thmgraybox}
    
	\mdfdefinestyle{mdbox}{%
		skipabove=8pt,
		linewidth=0.5pt
	}
	
	\declaretheoremstyle[
		headfont=\headingfont,
		mdframed={style=mdbox},
		headpunct={. },
		postheadspace={0pt},
		spaceabove=2pt,
		spacebelow=1pt
	]{thmbox}
	
    \ifprestoncolor
        \mdfdefinestyle{mdbluebox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=NavyBlue,
    		backgroundcolor=TealBlue!5,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{NavyBlue},
    		bodyfont=\itshape,
    		mdframed={style=mdbluebox},
    		headpunct={. },
    		postheadspace={0pt}
    	]{thmbluebox}
    	
    	\mdfdefinestyle{mdgreenbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=ForestGreen,
    		backgroundcolor=ForestGreen!5,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{ForestGreen},
    		mdframed={style=mdgreenbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmgreenbox}
    	
    	\mdfdefinestyle{mdorangebox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=orange,
    		backgroundcolor=Crimson!5,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{orange},
    		mdframed={style=mdorangebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmorangebox}
    	
    	\mdfdefinestyle{mdredbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=RawSienna,
    		backgroundcolor=Salmon!5,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{RawSienna},
    		mdframed={style=mdredbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmredbox}
    	
    	\mdfdefinestyle{mdblackbox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=black,
    		backgroundcolor=RedViolet!5!gray!5,
    	}
    
    	\declaretheoremstyle[
    		headfont=\itshape\sansfont,
    		mdframed={style=mdblackbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmblackbox}
    	
    	\mdfdefinestyle{mdpurplebox}{%
    		skipabove=8pt,
    		linewidth=3pt,
    		rightline=false,
    		leftline=true,
    		topline=false,
    		bottomline=false,
    		linecolor=RoyalPurple,
    		backgroundcolor=Orchid!4,
    	}
    
    	\declaretheoremstyle[
    		headfont=\headingfont\color{RoyalPurple},
    		mdframed={style=mdpurplebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmpurplebox}
    	
    \else
        \ifprestonmonochrome
            \mdfdefinestyle{mdbluebox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		bodyfont=\itshape,
        		mdframed={style=mdbluebox},
        		headpunct={. },
        		postheadspace={0pt}
        	]{thmbluebox}
        	
        	\mdfdefinestyle{mdgreenbox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		mdframed={style=mdgreenbox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmgreenbox}
        	
        	\mdfdefinestyle{mdorangebox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		mdframed={style=mdorangebox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmorangebox}
        	
        	\mdfdefinestyle{mdredbox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		mdframed={style=mdredbox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmredbox}
        	
        	\mdfdefinestyle{mdblackbox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\itshape\sansfont,
        		mdframed={style=mdblackbox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmblackbox}
        	
        	\mdfdefinestyle{mdpurplebox}{%
        		skipabove=8pt,
        		linewidth=0.5pt,
        		backgroundcolor=Gray!20,
        	}
        
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		mdframed={style=mdpurplebox},
        		headpunct={. },
        		postheadspace={0pt},
        	]{thmpurplebox}
        	
        \else
        	\declaretheoremstyle[
        		headfont=\headingfont,
        		bodyfont=\itshape,
        		mdframed={style=mdbox},
        		headpunct={. },
        		postheadspace={0pt},
        		spaceabove=2pt,
        		spacebelow=1pt
        	]{thmbluebox}
        	
        	\declaretheoremstyle[
        		headfont=\itshape\headingfont,
        		mdframed={style=mdbox},
        		headpunct={. },
        		postheadspace={0pt},
        		spaceabove=2pt,
        		spacebelow=1pt
        	]{thmblackbox}
        \fi
    \fi
\fi

\ifprestonmdthm
    \if\ifprestoncolor T\else\ifprestonmonochrome T\else F\fi\fi T%
        \theoremstyle{plain} % Theorem, Lemma, Proposition, Corollary
        
        \ifprestonchthm
            \declaretheorem[style=thmbluebox,name=Theorem,numberwithin=chapter]{thm}
    	\else
        	\ifprestonsecthm
        		\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{thm}
        	\else
        		\declaretheorem[style=thmbluebox,name=Theorem]{thm}
        	\fi
    	\fi
    	\declaretheorem[style=thmbluebox,name=Lemma,sibling=thm]{lemma}
    	\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{prop}
    	\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{cor}
    	
        \declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{thm*}
    	\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
    	\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{prop*}
    	\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{cor*}
    	
        \theoremstyle{definition} % Problem, example, definition, claim,
        % definition, conjecture, fact, question, answer, notation,
        % terminology, upshot, warning, bogus, boxed solution
    
        \ifprestonchthm
            \declaretheorem[name=Problem,numberwithin=chapter]{prob}
        \else
            \ifprestonsecthm
            	\declaretheorem[name=Problem,numberwithin=section]{prob}
            \else
                \declaretheorem[name=Problem]{prob}
            \fi
        \fi
        \declaretheorem[name=Problem,numbered=no]{prob*}
        
    	\declaretheorem[style=thmgreenbox,name=Problem,sibling=prob]{boxprob}
        \declaretheorem[style=thmredbox,name=Example,sibling=thm]{ex}
    	\declaretheorem[style=thmorangebox,name=Claim,sibling=thm]{claim}
    	
    	\declaretheorem[style=thmgreenbox,name=Problem,numbered=no]{boxprob*}
    	\declaretheorem[style=thmorangebox,name=Claim,numbered=no]{claim*}
        \declaretheorem[style=thmredbox,name=Example,numbered=no]{ex*}
    	\declaretheorem[style=thmpurplebox,name=Warning,numbered=no]{warn}
    	
        \declaretheorem[style=thmpurplebox,name=Bogus Solution,numbered=no]{bogussol}
        \declaretheorem[style=thmpurplebox,name=Bogus Proof,numbered=no]{boguspf}
        \declaretheorem[style=thmgraybox,name=Solution,numbered=no]{boxsol}
        \declaretheorem[style=thmgraybox,name=Proof,numbered=no]{boxpf}
    	
    	\theoremstyle{remark}
    	\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark}
    \else
        \theoremstyle{plain} % Theorem, Lemma, Proposition, Corollary
        
        \ifprestonchthm
            \declaretheorem[style=thmbluebox,name=Theorem,numberwithin=chapter]{thm}
    	\else
        	\ifprestonsecthm
        		\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{thm}
        	\else
        		\declaretheorem[style=thmbluebox,name=Theorem]{thm}
        	\fi
    	\fi
    	\declaretheorem[style=thmbluebox,name=Lemma,sibling=thm]{lemma}
    	\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{prop}
    	\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{cor}
    	
        \declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{thm*}
    	\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
    	\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{prop*}
    	\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{cor*}
    	
        \theoremstyle{definition} % Problem, example, definition, claim,
        % definition, conjecture, fact, question, answer, notation,
        % terminology, upshot, warning, bogus, boxed solution
    
        \ifprestonchthm
            \declaretheorem[name=Problem,numberwithin=chapter]{prob}
        \else
            \ifprestonsecthm
            	\declaretheorem[name=Problem,numberwithin=section]{prob}
            \else
                \declaretheorem[name=Problem]{prob}
            \fi
        \fi
        \declaretheorem[style=thmbox,name=Example,sibling=thm]{ex}
        \declaretheorem[name=Problem,numbered=no]{prob*}
        \declaretheorem[style=thmbox,name=Example,numbered=no]{ex*}
        
    	\declaretheorem[style=thmbox,name=Problem,sibling=prob]{boxprob}
    	\declaretheorem[style=thmbox,name=Claim,sibling=thm]{claim}
    	\declaretheorem[style=thmbox,name=Problem,numbered=no]{boxprob*}
    	\declaretheorem[style=thmbox,name=Claim,numbered=no]{claim*}
    	\declaretheorem[style=thmbox,name=Warning,numbered=no]{warn}
    	
        \declaretheorem[style=thmbox,name=Bogus Solution,numbered=no]{bogussol}
        \declaretheorem[style=thmbox,name=Bogus Proof,numbered=no]{boguspf}
        \declaretheorem[style=thmbox,name=Solution,numbered=no]{boxsol}
        \declaretheorem[style=thmbox,name=Proof,numbered=no]{boxpf}
    	
    	\theoremstyle{remark}
    	\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark}
    \fi
\else
    \theoremstyle{plain} % Theorem, Lemma, Proposition, Corollary
    
    \ifprestonchthm
        \declaretheorem[name=Theorem,numberwithin=chapter]{thm}
	\else
    	\ifprestonsecthm
    		\declaretheorem[name=Theorem,numberwithin=section]{thm}
    	\else
    		\declaretheorem[name=Theorem]{thm}
    	\fi
	\fi
	\declaretheorem[name=Lemma,sibling=thm]{lemma}
	\declaretheorem[name=Proposition,sibling=thm]{prop}
	\declaretheorem[name=Corollary,sibling=thm]{cor}
	
	\declaretheorem[name=Theorem,numbered=no]{thm*}
	\declaretheorem[name=Lemma,numbered=no]{lemma*}
	\declaretheorem[name=Proposition,numbered=no]{prop*}
	\declaretheorem[name=Corollary,numbered=no]{cor*}
	
	\theoremstyle{definition} % Problem, example, definition, claim,
    % definition, conjecture, fact, question, answer, notation,
    % terminology, upshot, warning
    
    \ifprestonchthm
        \declaretheorem[name=Problem,numberwithin=chapter]{prob}
    \else
        \ifprestonsecthm
        	\declaretheorem[name=Problem,numberwithin=section]{prob}
        \else
            \declaretheorem[name=Problem]{prob}
        \fi
    \fi
    \declaretheorem[name=Example,sibling=thm]{ex}
    \declaretheorem[name=Problem,numbered=no]{prob*}
    \declaretheorem[name=Example,numbered=no]{ex*}
    
	\declaretheorem[name=Claim,sibling=thm]{claim}
	\declaretheorem[name=Claim,numbered=no]{claim*}
	\declaretheorem[name=Warning,numbered=no]{warn}
	
	 \newenvironment{bogussol}[1][Bogus Solution] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}
    \newenvironment{boguspf}[1][Bogus Proof] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}
	
	\theoremstyle{remark}
	\declaretheorem[name=Remark,numbered=no]{remark}
\fi

%% Non-MD-style

\theoremstyle{definition}

\declaretheorem[name=Definition,sibling=thm]{defn}
\declaretheorem[name=Conjugate,sibling=thm]{conj}
\declaretheorem[name=Fact,sibling=thm]{fact}
\declaretheorem[name=Answer,sibling=prob]{fakeanswer}
\newenvironment{answer}{
    \addtocounter{prob}{-1}
    \begin{fakeanswer}
}{\end{fakeanswer}}

\declaretheorem[name=Definition,numbered=no]{defn*}
\declaretheorem[name=Conjugate,numbered=no]{conj*}
\declaretheorem[name=Fact,numbered=no]{fact*}
\declaretheorem[name=Question,numbered=no]{question}
\declaretheorem[name=Answer,numbered=no]{answer*}
\declaretheorem[name=Notation,numbered=no]{notation}
\declaretheorem[name=Terminology,numbered=no]{term}
\declaretheorem[name=Upshot,numbered=no]{upshot}
\declaretheorem[name=Exercise,sibling=thm]{exer}
\declaretheorem[name=Exercise,numbered=no]{exer*}

\theoremstyle{remark} % Remark, note

\declaretheorem[name=Note,numbered=no]{note}
\newenvironment{hint}{\scriptsize [Hint:}{\scriptsize\unskip]}
\newcommand{\proofprob}{\begin{note}This is a proof problem. Instead of entering an answer into the boxes below, please attach your proof to this paper.\end{note}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          PROOFS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand\qedsymbol{$\blacksquare$}

\ifprestonqednow
    \renewenvironment{proof}[1][\proofname]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{sol}[1][Solution]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
\else
    \newenvironment{sol}[1][Solution] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
\fi

\newenvironment{subproof}[1][\proofname]{\renewcommand{\qedsymbol}{$\Box$}\begin{proof}[#1]}{\end{proof}}
\newenvironment{progress}[1][Progress] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}

%% See above for bogus and boxed solution.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%          ASYMPTOTE          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[inline]{asymptote}
\begin{asydef}
    usepackage("bm");
    import olympiad;
\end{asydef}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%           CODE            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
    language=C++,
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=flexible,
    basicstyle={\small\ttfamily},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
    stringstyle=\color{mauve},
    breaklines=true,
    breakatwhitespace=true,
    tabsize=4,
    frame=single
}
