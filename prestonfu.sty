%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% prestonfu.sty
% Copyright (c) 2020 by Preston Fu
%
% All rights reserved. This file or any portion thereof
% may not be reproduced or used in any manner whatsoever
% without the express written permission of the publisher.
% 
% Thanks to Evan Chen and Eric Shen
% https://tinyurl.com/prestonfu-sty
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{prestonfu}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          OPTIONS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newif\ifprestonmdthm\prestonmdthmfalse
\newif\ifprestonbook\prestonbookfalse
\newif\ifprestonams\prestonamsfalse
\newif\ifprestoncolor\prestoncolortrue
\newif\ifprestonmonochrome\prestonmonochromefalse
\newif\ifprestonchthm\prestonchthmfalse
\newif\ifprestonsecthm\prestonsecthmtrue
\newif\ifprestonfancy\prestonfancytrue
\newif\ifprestonfancychap\prestonfancychaptrue
\newif\ifprestonfancysec\prestonfancysecfalse
\newif\ifprestoncolorheading\prestoncolorheadingfalse
\newif\ifprestonqednow\prestonqednowfalse
\newif\ifprestonfancyhint\prestonfancyhintfalse
\newif\ifprestonpazo\prestonpazofalse
\newif\ifprestonroboto\prestonrobotofalse
\newif\ifprestonmdline\prestonmdlinetrue
\newif\ifprestonsetlinespacing\prestonsetlinespacingtrue
\newif\ifprestonnoindent\prestonnoindentfalse
\newif\ifprestonmarginset\prestonmarginsettrue
\newif\ifprestonindex\prestonindexfalse

\DeclareOption{mdthm}{\prestonmdthmtrue}
\DeclareOption{nomdthm}{\prestonmdthmfalse}
\DeclareOption{book}{\prestonbooktrue}
\DeclareOption{color}{\prestoncolortrue}
\DeclareOption{monochrome}{\prestoncolorfalse\prestonmonochrometrue}
\DeclareOption{nocolor}{\prestoncolorfalse}
\DeclareOption{chthm}{\prestonchthmtrue}
\DeclareOption{secthm}{\prestonsecthmtrue}
\DeclareOption{nosecthm}{\prestonsecthmfalse}
\DeclareOption{fancy}{\prestonfancytrue}
\DeclareOption{nofancy}{\prestonfancyfalse}
\DeclareOption{fancychap}{\prestonfancychaptrue}
\DeclareOption{nofancychap}{\prestonfancychapfalse}
\DeclareOption{fancysec}{\prestonfancysectrue}
\DeclareOption{nofancysec}{\prestonfancysecfalse}
\DeclareOption{colorheading}{\prestoncolorheadingtrue}
\DeclareOption{nocolorheading}{\prestoncolorheadingfalse}
\DeclareOption{qednow}{\prestonqednowtrue}
\DeclareOption{qedright}{\prestonqednowfalse}
\DeclareOption{fancyhint}{\prestonfancyhinttrue}
\DeclareOption{nofancyhint}{\prestonfancyhintfalse}
\DeclareOption{pazo}{\prestonpazotrue}
\DeclareOption{nopazo}{\prestonpazofalse}
\DeclareOption{roboto}{\prestonrobototrue}
\DeclareOption{noroboto}{\prestonrobotofalse}
\DeclareOption{mdline}{\prestonmdlinetrue}
\DeclareOption{nomdline}{\prestonmdlinefalse}
\DeclareOption{nosetlinespace}{\preston}
\DeclareOption{noindent}{\prestonnoindenttrue}
\DeclareOption{nomarginset}{\prestonmarginsetfalse}
\DeclareOption{index}{\prestonindextrue}

\@ifundefined{KOMAClassName}{
    \prestoncolorfalse
    \prestonfancytrue
}{
    \prestonmdthmtrue
}

\DeclareOption{ams}{
    \prestoncolorfalse
    \prestonfancyfalse
    \prestonamstrue
}

\ProcessOptions\relax

\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{amsthm}
\usepackage{thmtools}
\PassOptionsToPackage{usenames,svgnames,dvipsnames}{xcolor}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage[english]{babel}
\usepackage{mathdots}
\usepackage[final]{pdfpages}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{epigraph}
\usepackage{hyperref}
\usepackage{mathrsfs}
\usepackage{textcomp}
\usepackage{emptypage}
\usepackage{appendix}
\usepackage{imakeidx}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%      USEFUL COMMANDS      %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\dotp}{\boldsymbol{\cdot}}
\newcommand{\x}{\times}
\newcommand{\cbrt}[1]{\sqrt[3]{#1}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\braces}[1]{\left \{ #1 \right \}}
\newcommand{\set}[1]{\left \{ #1 \right \}}
\newcommand{\parens}[1]{\left( #1 \right)}
\newcommand{\brackets}[1]{\left[ #1 \right]}
\newcommand{\angleb}[1]{\left\langle #1 \right\rangle}
\newcommand{\pfrac}[2]{\parens{\frac{#1}{#2}}}
\newcommand{\mailto}[1]{\href{mailto:#1}{\texttt{#1}}}
\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\eps}{\varepsilon}
\newcommand{\degs}{^\circ}
\newcommand{\inv}{^{-1}}
\newcommand{\hrulebar}{\begin{center}\nointerlineskip\vspace{5pt}\rule{\textwidth}{.7pt}\hspace{\fill}\end{center}}
\newcommand{\anschoices}[5]{\textbf{(A) }#1\qquad\textbf{(B) }#2\qquad\textbf{(C) }#3\qquad\textbf{(D) }#4\qquad\textbf{(E) }#5}

\definecolor{astral}{RGB}{46,116,181}
\definecolor{coldblue}{RGB}{0,81,120}
\definecolor{dkturquoise}{RGB}{0,131,138}
\definecolor{dkgreen}{RGB}{0,153,0}
\definecolor{gray}{RGB}{128,128,128}
\definecolor{mauve}{RGB}{148,0,210}

\renewcommand{\bold}[1]{{\boldmath\bfseries #1}}
\ifprestoncolor
    \colorlet{theme}{NavyBlue}
\else
    \ifprestonmonochrome
        \colorlet{theme}{coldblue}
    \else
        \colorlet{theme}{Black}
    \fi
\fi

\ifprestonams
    \newcommand{\vocab}[1]{\emph{#1}}
\else
    \newcommand{\vocab}[1]{\bold{\color{theme}{#1}}}
\fi

% Functions
\DeclareMathOperator*{\lcm}{lcm} % least common multiple
\DeclareMathOperator*{\re}{Re} % real part
\DeclareMathOperator*{\im}{Im} % imaginary part
\DeclareMathOperator*{\id}{id} % identity
\DeclareMathOperator*{\Pow}{Pow} % power
\DeclareMathOperator*{\diam}{diam} % diameter
\DeclareMathOperator*{\mesh}{mesh} % mesh
\DeclareMathOperator*{\ord}{ord} % order
\DeclareMathOperator*{\adj}{adj} % adjugate
\DeclareMathOperator*{\cur}{curl} % curl
\DeclareMathOperator*{\die}{div} % divergence
\DeclareMathOperator*{\cis}{cis} % cis
\DeclareMathOperator*{\rank}{rank} % rank
\DeclareMathOperator*{\Spec}{Spec} % spectrum
\DeclareMathOperator*{\Tr}{Tr} % trace
\DeclareMathOperator*{\Dom}{Dom} % domain
\DeclareMathOperator*{\Rng}{Rng} % range
\DeclareMathOperator*{\Aut}{Aut} % automorphism
\DeclareMathOperator*{\Inn}{Inn} % inner automorphism
\DeclareMathOperator*{\image}{im} % image
\DeclareMathOperator*{\Gal}{Gal} % Galois Group

% Sums and Products
\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

% Letters
\newcommand{\BB}{\mathbb B}
\newcommand{\CC}{\mathbb C}
\newcommand{\DD}{\mathbb D}
\newcommand{\EE}{\mathbb E}
\newcommand{\FF}{\mathbb F}
\newcommand{\GG}{\mathbb G}
\newcommand{\HH}{\mathbb H}
\newcommand{\II}{\mathbb I}
\newcommand{\JJ}{\mathbb J}
\newcommand{\KK}{\mathbb K}
\newcommand{\LL}{\mathbb L}
\newcommand{\MM}{\mathbb M}
\newcommand{\NN}{\mathbb N}
\newcommand{\OO}{\mathbb O}
\newcommand{\PP}{\mathbb P}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\TT}{\mathbb T}
\newcommand{\UU}{\mathbb U}
\newcommand{\VV}{\mathbb V}
\newcommand{\WW}{\mathbb W}
\newcommand{\XX}{\mathbb X}
\newcommand{\YY}{\mathbb Y}
\newcommand{\ZZ}{\mathbb Z}

\newcommand{\ii}{\textbf i}
\newcommand{\jj}{\textbf j}
\newcommand{\kk}{\textbf k}
\newcommand{\ihat}{\hat{\textbf \i}}
\newcommand{\jhat}{\hat{\textbf \j}}
\newcommand{\khat}{\hat\kk}

\newcommand{\mfA}{\mathfrak A}
\newcommand{\mfB}{\mathfrak B}
\newcommand{\mfC}{\mathfrak C}
\newcommand{\mfD}{\mathfrak D}
\newcommand{\mfE}{\mathfrak E}
\newcommand{\mfF}{\mathfrak F}
\newcommand{\mfG}{\mathfrak G}
\newcommand{\mfH}{\mathfrak H}
\newcommand{\mfI}{\mathfrak I}
\newcommand{\mfJ}{\mathfrak J}
\newcommand{\mfK}{\mathfrak K}
\newcommand{\mfL}{\mathfrak L}
\newcommand{\mfM}{\mathfrak M}
\newcommand{\mfN}{\mathfrak N}
\newcommand{\mfO}{\mathfrak O}
\newcommand{\mfP}{\mathfrak P}
\newcommand{\mfQ}{\mathfrak Q}
\newcommand{\mfR}{\mathfrak R}
\newcommand{\mfS}{\mathfrak S}
\newcommand{\mfT}{\mathfrak T}
\newcommand{\mfU}{\mathfrak U}
\newcommand{\mfV}{\mathfrak V}
\newcommand{\mfW}{\mathfrak W}
\newcommand{\mfX}{\mathfrak X}
\newcommand{\mfY}{\mathfrak Y}
\newcommand{\mfZ}{\mathfrak Z}

\newcommand{\mfa}{\mathfrak a}
\newcommand{\mfb}{\mathfrak b}
\newcommand{\mfc}{\mathfrak c}
\newcommand{\mfd}{\mathfrak d}
\newcommand{\mfe}{\mathfrak e}
\newcommand{\mff}{\mathfrak f}
\newcommand{\mfg}{\mathfrak g}
\newcommand{\mfh}{\mathfrak h}
\newcommand{\mfi}{\mathfrak i}
\newcommand{\mfj}{\mathfrak j}
\newcommand{\mfk}{\mathfrak k}
\newcommand{\mfl}{\mathfrak l}
\newcommand{\mfm}{\mathfrak m}
\newcommand{\mfn}{\mathfrak n}
\newcommand{\mfo}{\mathfrak o}
\newcommand{\mfp}{\mathfrak p}
\newcommand{\mfq}{\mathfrak q}
\newcommand{\mfr}{\mathfrak r}
\newcommand{\mfs}{\mathfrak s}
\newcommand{\mft}{\mathfrak t}
\newcommand{\mfu}{\mathfrak u}
\newcommand{\mfv}{\mathfrak v}
\newcommand{\mfw}{\mathfrak w}
\newcommand{\mfx}{\mathfrak x}
\newcommand{\mfy}{\mathfrak y}
\newcommand{\mfz}{\mathfrak z}

\newcommand{\mcA}{\mathcal A} 
\newcommand{\mcB}{\mathcal B} 
\newcommand{\mcC}{\mathcal C} 
\newcommand{\mcD}{\mathcal D} 
\newcommand{\mcE}{\mathcal E} 
\newcommand{\mcF}{\mathcal F} 
\newcommand{\mcG}{\mathcal G} 
\newcommand{\mcH}{\mathcal H} 
\newcommand{\mcI}{\mathcal I} 
\newcommand{\mcJ}{\mathcal J} 
\newcommand{\mcK}{\mathcal K} 
\newcommand{\mcL}{\mathcal L} 
\newcommand{\mcM}{\mathcal M} 
\newcommand{\mcN}{\mathcal N} 
\newcommand{\mcO}{\mathcal O} 
\newcommand{\mcP}{\mathcal P} 
\newcommand{\mcQ}{\mathcal Q} 
\newcommand{\mcR}{\mathcal R} 
\newcommand{\mcS}{\mathcal S} 
\newcommand{\mcT}{\mathcal T} 
\newcommand{\mcU}{\mathcal U} 
\newcommand{\mcV}{\mathcal V} 
\newcommand{\mcW}{\mathcal W} 
\newcommand{\mcX}{\mathcal X} 
\newcommand{\mcY}{\mathcal Y} 
\newcommand{\mcZ}{\mathcal Z}

\newcommand{\msA}{\mathscr A} 
\newcommand{\msB}{\mathscr B} 
\newcommand{\msC}{\mathscr C} 
\newcommand{\msD}{\mathscr D} 
\newcommand{\msE}{\mathscr E} 
\newcommand{\msF}{\mathscr F} 
\newcommand{\msG}{\mathscr G} 
\newcommand{\msH}{\mathscr H} 
\newcommand{\msI}{\mathscr I} 
\newcommand{\msJ}{\mathscr J} 
\newcommand{\msK}{\mathscr K} 
\newcommand{\msL}{\mathscr L} 
\newcommand{\msM}{\mathscr M} 
\newcommand{\msN}{\mathscr N} 
\newcommand{\msO}{\mathscr O} 
\newcommand{\msP}{\mathscr P} 
\newcommand{\msQ}{\mathscr Q} 
\newcommand{\msR}{\mathscr R} 
\newcommand{\msS}{\mathscr S} 
\newcommand{\msT}{\mathscr T} 
\newcommand{\msU}{\mathscr U} 
\newcommand{\msV}{\mathscr V} 
\newcommand{\msW}{\mathscr W} 
\newcommand{\msX}{\mathscr X} 
\newcommand{\msY}{\mathscr Y} 
\newcommand{\msZ}{\mathscr Z}

% Geometry
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle}
\newcommand{\ray}[1]{\overrightarrow{#1}} 
\newcommand{\seg}[1]{\overline{#1}}
\DeclareSymbolFont{yhlargesymbols}{OMX}{yhex}{m}{n}
\DeclareMathAccent{\wideparen}{\mathord}{yhlargesymbols}{"F3}
\newcommand{\arc}[1]{\wideparen{#1}}

% Custom enumerates
\newenvironment{anum}{ % (a), (b), ...
\begin{enumerate}[label = (\alph*)]}{\end{enumerate}}
\newenvironment{Rnum}{ % (I), (II), ...
\begin{enumerate}[label = (\Roman*)]}{\end{enumerate}}
\newenvironment{rnum}{ % (i), (ii), ...
\begin{enumerate}[label = (\roman*)]}{\end{enumerate}}

\newenvironment{myenum}{% no space
    \begin{enumerate}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{enumerate}}

\newenvironment{boldenum}{%
    \begin{enumerate}[label=\textbf{\arabic*.}]
}{\end{enumerate}}

\newenvironment{myitem}{% no space
    \begin{itemize}[topsep = 0pt]
    \setlength{\itemsep}{2pt}
    \setlength{\parskip}{0pt}
    \setlength{\parsep}{0pt}
}{\end{itemize}}

% Custom footnote
\@ifundefined{KOMAClassName}{}
{\renewcommand{\thefootnote}{\fnsymbol{footnote}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%         HYPERREF          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\hypersetup{
    colorlinks,
    citecolor=astral,
    filecolor=astral,
    linkcolor=black,
    urlcolor=astral
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%            PAGE SETUP            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifprestonsetlinespacing
    \ifprestonnoindent
        \setlength{\parindent}{0pt}
    \fi
    \setlength{\parskip}{0.6ex}
    \renewcommand{\baselinestretch}{1.05}
\fi

\ifprestonmarginset
    \setlength{\headheight}{16pt}
    \setlength{\headsep}{10pt}
\fi

\ifprestonpazo
    \usepackage{mathpazo}
\fi

\ifprestonroboto
    \usepackage{roboto}
\fi

\@ifundefined{KOMAClassName}
{
    \ifprestonmarginset
        \usepackage[margin=1in]{geometry}
    \fi
    
    \ifprestonfancy
        \usepackage{fancyhdr}
        \pagestyle{fancy}
        \fancyhf{}
        \ifprestonbook
            \renewcommand\chaptermark[1]{\markboth{#1}{}}
            \fancyhead[LO]{\textit{\nouppercase{\rightmark}}}
            \fancyhead[RE]{\textit{\nouppercase{\leftmark}}}
            \fancyhead[LE,RO]{\thepage}
            \renewcommand{\headrulewidth}{0pt}
        \else
            \lhead{\thetitle}
            \rhead{\theauthor}
            \cfoot{\thepage}
            \renewcommand{\headrulewidth}{0.5pt}
        \fi
    \fi
}
{
    \ifprestonmarginset
        \usepackage[margin=1in]{geometry}
		\setlength{\footskip}{0.5in}
	\fi
	
    \ifprestonfancy
        \ifprestonbook
            \usepackage{scrlayer-scrpage}
            \renewcommand\chaptermark[1]{\markboth{#1}{}}
            \renewcommand*{\headfont}{\bfseries\sffamily}
            \renewcommand*{\pnumfont}{\bfseries\sffamily}
            \ohead{\pagemark}
            \ofoot{}
            \cfoot{}
            \ihead{\headmark}
        \else
            \usepackage[headsepline]{scrlayer-scrpage}
			\renewcommand{\headfont}{}
			\ifprestonmarginset
    			\usepackage[margin=1in]{geometry}
    			\setlength{\footskip}{0.5in}
    		\fi
			\ihead{\small\textbf{\theauthor} (\thedate)}
			\automark{section}
			\chead{}
			\ohead{\small\textbf{\thetitle}}
			\cfoot{\pagemark}
        \fi
    \fi

    \addtokomafont{subtitle}{\Large}
    \setkomafont{author}{\large}
    \setkomafont{date}{\large}
    
    \@ifundefined{chapter}{}{
        \addtokomafont{part}{\sffamily\bfseries}
        \addtokomafont{chapter}{\sffamily\bfseries}
    }
    \addtokomafont{section}{\sffamily\bfseries}
    \addtokomafont{subsection}{\sffamily\bfseries}
    \addtokomafont{subsubsection}{\sffamily\bfseries}
    
    \@ifundefined{KOMAClassName}{}{
		\KOMAoptions{numbers=noenddot}
		\usepackage[tocindentauto]{tocstyle}
		\usetocstyle{KOMAlike}
		
		\ifprestoncolorheading
		    \colorlet{heading}{theme}
		\else
		    \colorlet{heading}{Black}
		\fi
		
		\@ifundefined{chapter}{}{
		    \addtokomafont{partprefix}{\rmfamily}
    		\renewcommand*{\partformat}{\color{heading}
    		    \scalebox{2.5}{\thepart}\enlargethispage{2em}}
    		    
		    \ifprestonfancychap
    			\addtokomafont{chapterprefix}{\raggedleft}
    			\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
    			\renewcommand*{\chapterformat}{\mbox{%
    				\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
    				\scalebox{2.718}{\color{heading}\thechapter}\enskip}}
			\else
    			\renewcommand*{\chapterformat}{\color{heading}\thechapter\enskip}
			\fi
        }
		
		\ifprestonfancychap
		    
		\fi
		
		\ifprestonfancysec
		    \renewcommand*{\sectionformat}{\color{heading}\S\thesection\enskip}
    		\renewcommand*{\subsectionformat}{\color{heading}\S\thesubsection\enskip}
    		\renewcommand*{\subsubsectionformat}{\color{heading}\S\thesubsubsection\enskip}
    	\else
    	    \renewcommand*{\sectionformat}{\color{heading}\thesection\enskip}
    		\renewcommand*{\subsectionformat}{\color{heading}\thesubsection\enskip}
    		\renewcommand*{\subsubsectionformat}{\color{heading}\thesubsubsection\enskip}
		\fi
	}
}

\ifprestonindex
    \makeindex[columns=2,intoc]
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          THEOREMS         %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifprestonmdthm

    \ifprestonmdline
        \def\mdlinewidth{3pt}
    \else
        \def\mdlinewidth{0pt}
    \fi

    \mdfdefinestyle{mdbluebox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=NavyBlue,
		backgroundcolor=TealBlue!5,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}

    \mdfdefinestyle{mdaquabox}{%
    	skipabove=8pt,
    	linewidth=\mdlinewidth,
    	rightline=false,
    	leftline=true,
    	topline=false,
    	bottomline=false,
    	linecolor=dkturquoise,
    	backgroundcolor=Emerald!5,
    	innertopmargin=9pt,
		innerbottommargin=9pt,
    }
	
	\mdfdefinestyle{mdredbox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=BrickRed,
		backgroundcolor=VioletRed!5,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\mdfdefinestyle{mdbrownbox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=RawSienna,
		backgroundcolor=Salmon!5,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\mdfdefinestyle{mdgreenbox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=ForestGreen,
		backgroundcolor=ForestGreen!5,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\mdfdefinestyle{mdorangebox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=orange,
		backgroundcolor=Crimson!4,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\mdfdefinestyle{mdpurplebox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=RoyalPurple,
		backgroundcolor=Plum!10,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\mdfdefinestyle{mdblackbox}{%
        skipabove=8pt,
        linewidth=\mdlinewidth,
        rightline=false,
        leftline=true,
        topline=false,
        bottomline=false,
        linecolor=black,
        backgroundcolor=RedViolet!5!gray!5,
		innertopmargin=9pt,
		innerbottommargin=9pt,
    }
	
	\mdfdefinestyle{mdthemebox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=coldblue,
		backgroundcolor=coldblue!7,
		innertopmargin=9pt,
		innerbottommargin=9pt
	}
	
	\mdfdefinestyle{mdgraybox}{%
		skipabove=8pt,
		linewidth=\mdlinewidth,
		rightline=false,
		leftline=true,
		topline=false,
		bottomline=false,
		linecolor=Gray!40!Black!60,
		backgroundcolor=Gray!10,
		innertopmargin=9pt,
		innerbottommargin=9pt,
	}
	
	\ifprestoncolor

    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{NavyBlue},
    		bodyfont=\itshape,
    		mdframed={style=mdbluebox},
    		headpunct={. },
    		postheadspace={0pt}
    	]{thmbluebox}
        
        \declaretheoremstyle[
        	headfont=\sffamily\bfseries\color{dkturquoise},
        	mdframed={style=mdaquabox},
        	headpunct={. },
        	postheadspace={0pt}
        ]{thmaquabox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{BrickRed},
    		mdframed={style=mdredbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmredbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{RawSienna},
    		mdframed={style=mdbrownbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmbrownbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{ForestGreen},
    		mdframed={style=mdgreenbox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmgreenbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{orange},
    		mdframed={style=mdorangebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmorangebox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{RoyalPurple},
    		mdframed={style=mdpurplebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmpurplebox}
    	
        \declaretheoremstyle[
            headfont=\sffamily\bfseries\small,
            bodyfont=\normalfont\small,
            mdframed={style=mdblackbox},
        ]{thmblackbox}
        
    \else\ifprestonmonochrome
        
        \declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		bodyfont=\itshape,
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt}
    	]{thmbluebox}
        
        \declaretheoremstyle[
        	headfont=\sffamily\bfseries\color{coldblue},
        	mdframed={style=mdthemebox},
        	headpunct={. },
        	postheadspace={0pt}
        ]{thmaquabox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmredbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmbrownbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmgreenbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmorangebox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{coldblue},
    		mdframed={style=mdthemebox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmpurplebox}
    	
        \declaretheoremstyle[
            headfont=\sffamily\bfseries\small\color{coldblue},
            bodyfont=\normalfont\small,
            mdframed={style=mdthemebox},
        ]{thmblackbox}
        
    \else 
        
        \declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		bodyfont=\itshape,
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt}
    	]{thmbluebox}
        
        \declaretheoremstyle[
        	headfont=\sffamily\bfseries\color{Gray!40!Black!100},
        	mdframed={style=mdgraybox},
        	headpunct={. },
        	postheadspace={0pt}
        ]{thmaquabox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmredbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmbrownbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmgreenbox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmorangebox}
    
    	\declaretheoremstyle[
    		headfont=\sffamily\bfseries\color{Gray!40!Black!100},
    		mdframed={style=mdgraybox},
    		headpunct={. },
    		postheadspace={0pt},
    	]{thmpurplebox}
    	
        \declaretheoremstyle[
            headfont=\sffamily\bfseries\small\color{Gray!40!Black!100},
            bodyfont=\normalfont\small,
            mdframed={style=mdgraybox},
        ]{thmblackbox}
        
    \fi
    \fi
    
    \theoremstyle{plain}
    
    \ifprestonchthm
        \declaretheorem[style=thmbluebox,name=Theorem,numberwithin=chapter]{thm}
	\else
    	\ifprestonsecthm
    		\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{thm}
    	\else
    		\declaretheorem[style=thmbluebox,name=Theorem]{thm}
    	\fi
	\fi
	
	\declaretheorem[style=thmbluebox,name=Lemma,sibling=thm]{lemma}
	\declaretheorem[style=thmbluebox,name=Lemma]{ilemma}
	\declaretheorem[style=thmbluebox,name=Proposition,sibling=thm]{prop}
	\declaretheorem[style=thmbluebox,name=Fact,sibling=thm]{fact}
	\declaretheorem[style=thmbluebox,name=Corollary,sibling=thm]{cor}
	
    \declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{thm*}
	\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
	\declaretheorem[style=thmbluebox,name=Fact,numbered=no]{fact*}
	\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{prop*}
	\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{cor*}
	
    \theoremstyle{definition}
    
    \declaretheorem[style=thmaquabox,name=Definition,sibling=thm]{defn}
    \declaretheorem[style=thmaquabox,name=Definition,numbered=no]{defn*}
    \declaretheorem[style=thmaquabox,name=Notation,sibling=thm]{notn}
    \declaretheorem[style=thmaquabox,name=Notation,numbered=no]{notn*}
    \declaretheorem[style=thmaquabox,name=Terminology,sibling=thm]{term}
    \declaretheorem[style=thmaquabox,name=Terminology,numbered=no]{term*}
    
    \declaretheorem[style=thmredbox,name=Concept,numbered=no]{concept}
    \declaretheorem[style=thmredbox,name=Idea,numbered=no]{idea}
    \declaretheorem[style=thmredbox,name=Takeaway,numbered=no]{takeaway}
    
    \declaretheorem[style=thmbrownbox,name=Example,sibling=thm]{ex}
    \declaretheorem[style=thmbrownbox,name=Example,numbered=no]{ex*}

    \ifprestonchthm
        \declaretheorem[name=Problem,numberwithin=chapter]{prob}
    \else
        \ifprestonsecthm
        	\declaretheorem[name=Problem,numberwithin=section]{prob}
        \else
            \declaretheorem[name=Problem]{prob}
        \fi
    \fi
    
    \declaretheorem[style=thmgreenbox,name=Problem,numbered=no]{prob*}
	\declaretheorem[style=thmgreenbox,name=Problem,sibling=prob]{boxprob}
	\declaretheorem[style=thmgreenbox,name=Problem,numbered=no]{boxprob*}
	\declaretheorem[style=thmgreenbox,name=Exercise,sibling=thm]{exer}
	\declaretheorem[style=thmgreenbox,name=Exercise,numbered=no]{exer*}
    
	\declaretheorem[style=thmorangebox,name=Claim,sibling=thm]{claim}
	\declaretheorem[style=thmorangebox,name=Claim]{iclaim}
	\declaretheorem[style=thmorangebox,name=Claim,numbered=no]{claim*}
	
	\declaretheorem[style=thmpurplebox,name=Warning,sibling=thm]{warn}
	\declaretheorem[style=thmpurplebox,name=Warning,numbered=no]{warn*}
    \declaretheorem[style=thmpurplebox,name=Bogus Solution,numbered=no]{bogussol}
    \declaretheorem[style=thmpurplebox,name=Bogus Proof,numbered=no]{bogusproof}

	\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark}
	\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark*}
    
\else

    \theoremstyle{plain}

    \ifprestonchthm
        \declaretheorem[name=Theorem,numberwithin=chapter]{thm}
	\else
    	\ifprestonsecthm
    		\declaretheorem[name=Theorem,numberwithin=section]{thm}
    	\else
    		\declaretheorem[name=Theorem]{thm}
    	\fi
	\fi
	
	\declaretheorem[name=Lemma,sibling=thm]{lemma}
	\declaretheorem[name=Lemma]{ilemma}
	\declaretheorem[name=Proposition,sibling=thm]{prop}
	\declaretheorem[name=Fact,sibling=thm]{fact}
	\declaretheorem[name=Corollary,sibling=thm]{cor}
	
    \declaretheorem[name=Theorem,numbered=no]{thm*}
	\declaretheorem[name=Lemma,numbered=no]{lemma*}
	\declaretheorem[name=Proposition,numbered=no]{prop*}
	\declaretheorem[name=Fact,numbered=no]{fact*}
	\declaretheorem[name=Corollary,numbered=no]{cor*}
	
    \theoremstyle{definition}
    
    \declaretheorem[name=Definition,sibling=thm]{defn}
    \declaretheorem[name=Definition,numbered=no]{defn*}
    \declaretheorem[name=Notation,sibling=thm]{notn}
    \declaretheorem[name=Notation,numbered=no]{notn*}
    \declaretheorem[name=Terminology,sibling=thm]{term}
    \declaretheorem[name=Terminology,numbered=no]{term*}
    
    \declaretheorem[name=Concept,numbered=no]{concept}
    \declaretheorem[name=Idea,numbered=no]{idea}
    \declaretheorem[name=Takeaway,numbered=no]{takeaway}
    
    \declaretheorem[name=Example,sibling=thm]{ex}
    \declaretheorem[name=Example,numbered=no]{ex*}

    \ifprestonchthm
        \declaretheorem[name=Problem,numberwithin=chapter]{prob}
    \else
        \ifprestonsecthm
        	\declaretheorem[name=Problem,numberwithin=section]{prob}
        \else
            \declaretheorem[name=Problem]{prob}
        \fi
    \fi

	\declaretheorem[name=Problem,numbered=no]{prob*}
	\declaretheorem[name=Exercise,sibling=thm]{exer}
	\declaretheorem[name=Exercise,numbered=no]{exer*}
    
	\declaretheorem[name=Claim,sibling=thm]{claim}
	\declaretheorem[name=Claim]{iclaim}
	\declaretheorem[name=Claim,numbered=no]{claim*}
	
	\declaretheorem[name=Warning,sibling=thm]{warn}
	\declaretheorem[name=Warning,numbered=no]{warn*}
    \declaretheorem[name=Bogus Solution,numbered=no]{bogussol}
    \declaretheorem[name=Bogus Proof,numbered=no]{bogusproof}

	\declaretheorem[name=Remark,numbered=no]{remark}
	\declaretheorem[name=Remark,numbered=no]{remark*}
\fi

\theoremstyle{definition}

\declaretheorem[name=Conjecture,sibling=thm]{conj}
\declaretheorem[name=Question,sibling=thm]{question}

\ifprestonchthm
    \declaretheorem[name=Answer,numberwithin=chapter]{answer}
\else
	\ifprestonsecthm
		\declaretheorem[name=Answer,numberwithin=section]{answer}
	\else
		\declaretheorem[name=Answer]{answer}
	\fi
\fi

\declaretheorem[name=Conjecture,numbered=no]{conj*}
\declaretheorem[name=Question,numbered=no]{question*}
\declaretheorem[name=Answer,numbered=no]{answer*}
\declaretheorem[name=Note,numbered=no]{note}
\declaretheorem[name=Algorithm,numbered=no]{algo}
\declaretheorem[name=Abuse of Notation,numbered=no]{abuse}
\declaretheorem[name=Upshot,numbered=no]{upshot}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%           HINT           %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{hints}{\noindent\footnotesize\normalfont\textbf{Hints: }}{\hspace{-0.5ex}}
\newenvironment{hint}{\noindent\footnotesize\normalfont\textbf{Hint: }}{\hspace{-0.5ex}}

\ifprestonfancyhint %% Evan Chen
    \usepackage{etoolbox}
    \usepackage{tikz}
    \usepackage{ifthen}
    \usepackage{answers}
    
    \newcounter{hindex}\setcounter{hindex}{0}
    \newcounter{hintcounter}\setcounter{hintcounter}{0}
    
    \newcommand{\addhint}[1]{%
    	\stepcounter{hintcounter}%
    	\ref{hint:\thehintcounter}%
    	\expandafter\gdef\csname hintlist\thehintcounter\endcsname{#1}%
    }
    \newcommand\gethint[1]{\item \csname hintlist#1\endcsname \label{hint:#1}}
\else
    \newcommand{\addhint}[1]{#1}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%          PROOFS          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand\qedsymbol{$\blacksquare$}

\ifprestonqednow
    \renewenvironment{proof}[1][\proofname]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{sol}[1][Solution]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch]{\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\nolinebreak\qedsymbol\endtrivlist\@endpefalse}
\else
    \newenvironment{sol}[1][Solution] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{solsketch}[1][Solution Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
    \newenvironment{pfsketch}[1][Proof Sketch] {\par\pushQED{\qed}\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\bfseries#1\@addpunct{.}]\ignorespaces}{\popQED\endtrivlist\@endpefalse}
\fi 

\newenvironment{subproof}[1][\proofname]{\renewcommand{\qedsymbol}{$\Box$}\begin{proof}[#1]}{\end{proof}}
\newenvironment{progress}[1][Progress] {\par\normalfont\topsep6\p@\@plus6\p@\relax\trivlist\item[\hskip\labelsep\itshape#1\@addpunct{.}]\ignorespaces}{\endtrivlist\@endpefalse}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%          ASYMPTOTE          %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[inline]{asymptote}
\usepackage{pgfplots}

\begin{asydef}
    import olympiad;
	usepackage("bm");
    usepackage("amsmath");
	usepackage("amssymb");
	defaultpen(fontsize(11pt));
\end{asydef}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%           CODE            %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}

\lstset{frame=tb,
    language=C++,
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=flexible,
    basicstyle={\small\ttfamily},
    numbers=left,
    numbersep=5pt,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
    stringstyle=\color{mauve},
    breaklines=true,
    breakatwhitespace=true,
    tabsize=4,
    frame=single
}
